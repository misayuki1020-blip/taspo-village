<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>タスポ・ヴィレッジ</title>
    <style>
        :root {
            --bg-color: #f0f4f8;
            --window-bg: #ffffff;
            --primary: #333;
            --accent: #ff6f61;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            color: var(--primary);
            display: flex; flex-direction: column; height: 100vh;
        }

        /* ヘッダー：共通ステータス */
        header {
            background: #333; color: white; padding: 10px;
            display: flex; justify-content: space-between; align-items: center;
        }

        /* 画面エリア */
        .screen {
            flex: 1; overflow-y: auto; display: none; padding: 20px;
        }
        .active { display: block; }

        /* フッター：タブメニュー */
        nav {
            display: flex; background: #fff; border-top: 2px solid #ddd;
        }
        nav button {
            flex: 1; padding: 15px; border: none; background: none;
            font-weight: bold; cursor: pointer; border-right: 1px solid #eee;
        }
        nav button:last-child { border-right: none; }
        nav button.active-tab { background: #eee; border-top: 4px solid var(--accent); }

        /* キャラクター表示パーツ（前回のを流用） */
        .char-container {
            width: 150px; height: 150px; margin: 0 auto; position: relative;
        }
        .char-part { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        /* 村の柵エリア */
        .village-fence {
            background: #d4edda; border: 8px solid #8d6e63;
            height: 300px; position: relative; border-radius: 20px; overflow: hidden;
        }
        .village-pet { position: absolute; width: 60px; height: 60px; transition: all 1s; }

        /* タスクリスト */
        .task-item {
            background: white; margin-bottom: 10px; padding: 15px;
            border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex; justify-content: space-between; align-items: center;
        }

        .btn {
            background: var(--primary); color: white; border: none;
            padding: 8px 15px; border-radius: 5px; cursor: pointer;
        }
    </style>
</head>
<body>

<header>
    <div>タスポ: <span id="totalTaspo">0</span> TP</div>
    <div>村の人口: <span id="popCount">0</span> 匹</div>
</header>

<div id="screen-main" class="screen active">
    <h2>育成ルーム</h2>
    <div class="char-container" id="mainPetDisplay"></div>
    <div style="text-align: center; margin-top: 20px;">
        <h3 id="mainPetName">---</h3>
        <p>お腹: <span id="mainPetHunger">0</span>%</p>
        <button class="btn" onclick="feedActivePet()">ごはんをあげる (10TP)</button>
    </div>
</div>

<div id="screen-task" class="screen">
    <h2>タスク</h2>
    <div style="display:flex; margin-bottom:20px;">
        <input type="text" id="taskInput" style="flex:1; padding:10px;" placeholder="やることを入力...">
        <button class="btn" onclick="addTask()">追加</button>
    </div>
    <div id="taskList"></div>
</div>

<div id="screen-village" class="screen">
    <h2>タスポ・ヴィレッジ</h2>
    <div class="village-fence" id="villageFence">
        </div>
    <div style="margin-top: 20px;">
        <button class="btn" onclick="alert('配合機能は開発中！')">配合（ブリーディング）</button>
        <p style="font-size: 0.8em; color: #666;">※村にキャラが増えるほどタスク報酬が分散されます。</p>
    </div>
</div>

<nav>
    <button id="tab-main" class="active-tab" onclick="showScreen('main')">メイン</button>
    <button id="tab-task" onclick="showScreen('task')">タスク</button>
    <button id="tab-village" onclick="showScreen('village')">村</button>
</nav>

<svg id="svg-defs" style="display:none;">
    <symbol id="body_round" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="currentColor" stroke="#333" stroke-width="4"/></symbol>
    <symbol id="eyes_a" viewBox="0 0 100 100"><circle cx="35" cy="45" r="5" fill="#333"/><circle cx="65" cy="45" r="5" fill="#333"/></symbol>
    <symbol id="mouth_a" viewBox="0 0 100 100"><path d="M 40 65 Q 50 75 60 65" stroke="#333" stroke-width="3" fill="none"/></symbol>
</svg>

<script>
// --- データ管理 ---
let gameState = {
    totalTaspo: 100,
    tasks: [],
    characters: [
        { id: 1, name: "タスポくん", location: "main", hunger: 80, color: "#FFD700" }
    ]
};

// ローカルストレージからロード
const saved = localStorage.getItem('taspoGameData');
if (saved) gameState = JSON.parse(saved);

function save() {
    localStorage.setItem('taspoGameData', JSON.stringify(gameState));
    updateUI();
}

// --- 画面切り替え ---
function showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('nav button').forEach(b => b.classList.remove('active-tab'));
    
    document.getElementById('screen-' + screenId).classList.add('active');
    document.getElementById('tab-' + screenId).classList.add('active-tab');
    
    if(screenId === 'village') renderVillage();
}

// --- UI更新 ---
function updateUI() {
    document.getElementById('totalTaspo').innerText = gameState.totalTaspo;
    document.getElementById('popCount').innerText = gameState.characters.length;

    // メインキャラ表示
    const mainPet = gameState.characters.find(c => c.location === 'main');
    if (mainPet) {
        document.getElementById('mainPetName').innerText = mainPet.name;
        document.getElementById('mainPetHunger').innerText = mainPet.hunger;
        renderChar(mainPet, 'mainPetDisplay');
    }

    // タスクリスト表示
    const taskList = document.getElementById('taskList');
    taskList.innerHTML = '';
    gameState.tasks.forEach((t, index) => {
        taskList.innerHTML += `
            <div class="task-item">
                <span>${t.text}</span>
                <button class="btn" onclick="completeTask(${index})">完了</button>
            </div>
        `;
    });
}

// キャラ描画
function renderChar(char, targetId, size = "100%") {
    const target = document.getElementById(targetId);
    target.innerHTML = `
        <svg class="char-part" style="color: ${char.color};"><use href="#body_round"/></svg>
        <svg class="char-part"><use href="#eyes_a"/></svg>
        <svg class="char-part"><use href="#mouth_a"/></svg>
    `;
}

// 村の住民描画
function renderVillage() {
    const fence = document.getElementById('villageFence');
    fence.innerHTML = '';
    gameState.characters.forEach(c => {
        const div = document.createElement('div');
        div.className = 'village-pet';
        div.style.left = Math.random() * 80 + '%';
        div.style.top = Math.random() * 70 + '%';
        div.id = 'vpet-' + c.id;
        fence.appendChild(div);
        renderChar(c, div.id);
    });
}

// --- アクション ---
function addTask() {
    const input = document.getElementById('taskInput');
    if (!input.value) return;
    gameState.tasks.push({ text: input.value });
    input.value = '';
    save();
}

function completeTask(index) {
    // 分配の法則：人数が多いほど1回あたりの報酬が減る
    const reward = Math.max(5, Math.floor(50 / gameState.characters.length));
    gameState.totalTaspo += reward;
    gameState.tasks.splice(index, 1);
    alert(`${reward} TP獲得！`);
    save();
}

function feedActivePet() {
    const mainPet = gameState.characters.find(c => c.location === 'main');
    if (gameState.totalTaspo >= 10 && mainPet) {
        gameState.totalTaspo -= 10;
        mainPet.hunger = Math.min(100, mainPet.hunger + 20);
        save();
    } else {
        alert("TPが足りません！");
    }
}

// 初期起動
updateUI();
</script>
</body>
</html>
